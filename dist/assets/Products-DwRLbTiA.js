import{r as V,a as J,p as A,o as E,w as s,b as a,h as e,E as K,W,X as U,f as b,g as C,Y as R,c as j,F as T,H as S,Z as z,_ as X,s as F,$ as Y,a0 as Z,e as B,j as D,k as M,K as h,a1 as Q,a2 as w,a3 as ee,M as ae,a4 as le,G as te,a5 as se,a6 as oe,a7 as x,a8 as re,a9 as ne,aa as ue,ab as ie,ac as de,ad as ce}from"./index-DTjOUT29.js";import{a as N}from"./api-D0beKIRp.js";import{u as pe}from"./upload-CdCxZR_z.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me=(g=1,f="")=>N.get(`/admin/products?page=${g}&category=${f}`),ge=g=>N.post("/admin/product",{data:g}),fe=(g,f)=>N.put(`/admin/product/${g}`,{data:f}),ve=g=>N.delete(`/admin/product/${g}`),_e={class:"dialog-footer"},ye={__name:"DialogAdminProduct",props:{categoryList:{type:Array,required:!0}},emits:["product-added"],setup(g,{expose:f,emit:i}){const $=g,L=i,v=V([]),m=V(!1),_=V(!1),c=V(!0),r=J({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:[]}),q=o=>{if(v.value=[],Object.assign(r,{title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:[]}),o){c.value=!0;let l=o.imagesUrl.map((t,n)=>({name:`image${n+1}`,url:t,status:"success"}));Object.assign(r,{...o,is_enabled:!!o.is_enabled,imagesUrl:l}),v.value=l,_.value=!0}else c.value=!1,_.value=!0},I=async o=>{var t,n,P,O;m.value=!0;const l={...o,origin_price:Number(o.origin_price),price:Number(o.price),is_enabled:+o.is_enabled,imageUrl:"",imagesUrl:o.imagesUrl};c.value&&(l.imagesUrl=o.imagesUrl.map(d=>{if(typeof d=="string")return d;if(typeof d.url=="string")return d.url}));try{const d=c.value?await fe(o.id,l):await ge(l);d.success?(w({type:"success",message:d.message}),L("product-added"),_.value=!1):w({type:"error",message:d.message})}catch(d){console.error(d);const H=((O=(P=(n=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:n.message)==null?void 0:P.join)==null?void 0:O.call(P,","))||"操作失敗";w({type:"error",message:H})}finally{m.value=!1}},y=o=>{if(o.type!=="image/jpeg"&&o.type!=="image/png")return w({type:"error",message:"上傳圖片檔案類型應為PNG或JPEG"}),!1;if(o.size/1024/1024>3)return w({type:"error",message:"上傳圖片大小應小於3MB"}),!1},u=async({file:o,onSuccess:l,onError:t})=>{try{const n=await pe(o),P={name:o.name,url:n.imageUrl,status:n.success?"success":"false"};v.value.push(P),r.imagesUrl.push(P.url),l()}catch(n){t(n)}},p=o=>{r.imagesUrl=r.imagesUrl.filter(l=>l.url!==o.url),v.value=v.value.filter(l=>l.url!==o.url)},k=o=>{window.open(o.url)};return f({open:q}),(o,l)=>(E(),A(e(Q),{modelValue:_.value,"onUpdate:modelValue":l[10]||(l[10]=t=>_.value=t),width:"800"},{header:s(()=>[B("h3",null,h(c.value?"修改產品":"新增產品"),1)]),footer:s(()=>[B("div",_e,[a(e(D),{onClick:l[8]||(l[8]=t=>_.value=!1)},{default:s(()=>l[11]||(l[11]=[M("取消")])),_:1}),a(e(D),{type:"primary",onClick:l[9]||(l[9]=t=>I(r))},{default:s(()=>l[12]||(l[12]=[M(" 確認 ")])),_:1})])]),default:s(()=>[a(e(K),{model:r,"label-width":"auto"},{default:s(()=>[a(e(W),{gutter:20},{default:s(()=>[a(e(U),{span:24},{default:s(()=>[a(e(b),{label:"標題"},{default:s(()=>[a(e(C),{modelValue:r.title,"onUpdate:modelValue":l[0]||(l[0]=t=>r.title=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"分類"},{default:s(()=>[a(e(R),{modelValue:r.category,"onUpdate:modelValue":l[1]||(l[1]=t=>r.category=t),filterable:"",placeholder:"請選擇類別"},{default:s(()=>[(E(!0),j(T,null,S($.categoryList,(t,n)=>(E(),A(e(z),{key:n,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"單位"},{default:s(()=>[a(e(C),{modelValue:r.unit,"onUpdate:modelValue":l[2]||(l[2]=t=>r.unit=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"原價"},{default:s(()=>[a(e(C),{type:"number",modelValue:r.origin_price,"onUpdate:modelValue":l[3]||(l[3]=t=>r.origin_price=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"售價"},{default:s(()=>[a(e(C),{type:"number",modelValue:r.price,"onUpdate:modelValue":l[4]||(l[4]=t=>r.price=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:24},{default:s(()=>[a(e(b),{label:"圖片上傳"},{default:s(()=>[a(e(X),{"http-request":u,"file-list":v.value,"list-type":"picture-card","on-remove":p,"before-upload":y,"on-preview":k},{default:s(()=>[a(e(F),null,{default:s(()=>[a(e(Y))]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"產品描述"},{default:s(()=>[a(e(C),{type:"textarea",modelValue:r.description,"onUpdate:modelValue":l[5]||(l[5]=t=>r.description=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(e(U),{span:12},{default:s(()=>[a(e(b),{label:"說明內容"},{default:s(()=>[a(e(C),{type:"textarea",modelValue:r.content,"onUpdate:modelValue":l[6]||(l[6]=t=>r.content=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(e(b),{label:"是否啟用"},{default:s(()=>[a(e(Z),{modelValue:r.is_enabled,"onUpdate:modelValue":l[7]||(l[7]=t=>r.is_enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]))}},be=G(ye,[["__scopeId","data-v-ef3f14c9"]]),Ve={class:"top-area"},Ue={class:"content-area"},Ee={class:"bottom-area"},Pe={__name:"Products",setup(g){const f=V(!1),i=V(1),$=ee("dialogAdminProduct"),L=V([]),v=V(),m=V(""),_=[{value:"",label:"全部"},{value:"戒指",label:"戒指"},{value:"項鍊",label:"項鍊"},{value:"手鐲",label:"手鐲"},{value:"耳環",label:"耳環"}],c=async(y=1,u="")=>{i.value=y,m.value=u,f.value=!0;try{const p=await me(i.value,m.value);p.success&&(L.value=p.products,i.value=p.pagination.current_page,v.value=p.pagination.total_pages)}catch(p){console.error(p)}finally{f.value=!1}},r=()=>{$.value.open()},q=y=>{$.value.open(y)},I=async y=>{await ce.confirm(`請確認是否刪除產品：${y.title}`,{showClose:!1,confirmButtonText:"確認",cancelButtonText:"取消",type:"warning",beforeClose:async(u,p,k)=>{if(u==="confirm"){p.confirmButtonLoading=!0;try{const o=await ve(y.id);if(o.success){w({type:"success",message:o.message}),k();const l=await c(i.value,m.value);l.success&&l.products&&!(l.products.length>0)&&i.value>1&&(i.value-=1),await c(i.value,m.value)}else w({type:"error",message:o.message})}catch(o){console.error(o)}finally{f.value=!1}}else k()}})};return ae(i,()=>{c(i.value,m.value)}),le(()=>{c()}),(y,u)=>{const p=z,k=R,o=te("font-awesome-icon"),l=ue;return E(),j(T,null,[a(e(de),{class:"card"},{default:s(()=>[B("div",Ve,[a(k,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=t=>m.value=t),filterable:"",placeholder:"請選擇查詢類別",onChange:u[1]||(u[1]=t=>c(1,m.value))},{default:s(()=>[(E(),j(T,null,S(_,(t,n)=>a(p,{key:n,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(e(D),{type:"primary",class:"btn-add-product",onClick:r},{default:s(()=>u[3]||(u[3]=[M(" 新增產品 ")])),_:1})]),B("div",Ue,[se((E(),A(e(oe),{stripe:!0,data:L.value,style:{height:"100%"},"table-layout":"auto"},{default:s(()=>[a(e(x),{label:"名稱",prop:"title"}),a(e(x),{label:"分類",prop:"category"}),a(e(x),{label:"原價",prop:"origin_price",align:"center"}),a(e(x),{label:"特價",prop:"price",align:"center"}),a(e(x),{label:"啟用",prop:"is_enabled",align:"center"},{default:s(({row:t})=>[t.is_enabled?(E(),A(e(F),{key:0,class:"check-icon"},{default:s(()=>[a(o,{icon:["fas","check"]})]),_:1})):(E(),A(e(F),{key:1,class:"x-icon"},{default:s(()=>[a(o,{icon:["fas","xmark"]})]),_:1}))]),_:1}),a(e(x),{width:"1"},{default:s(({row:t})=>[a(e(D),{icon:e(re),size:"small",onClick:n=>q(t)},null,8,["icon","onClick"]),a(e(D),{icon:e(ne),type:"danger",size:"small",onClick:n=>I(t)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[l,f.value]])]),B("div",Ee,[a(e(ie),{class:"pagination","current-page":i.value,"onUpdate:currentPage":u[2]||(u[2]=t=>i.value=t),layout:"prev, pager, next, jumper","page-count":v.value},null,8,["current-page","page-count"])])]),_:1}),a(e(be),{ref_key:"dialogAdminProduct",ref:$,onProductAdded:c,categoryList:_},null,512)],64)}}},$e=G(Pe,[["__scopeId","data-v-2216d373"]]);export{$e as default};
