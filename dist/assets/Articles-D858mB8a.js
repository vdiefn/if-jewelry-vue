import{a as B}from"./api-D0beKIRp.js";import{r as i,a as W,a5 as z,aa as F,p as y,o as d,w as o,b as a,h as l,E as G,W as H,X as g,f as _,g as D,ag as X,c as M,F as j,H as S,ah as Y,k as v,K as R,ai as J,j as x,_ as Q,a0 as Z,e as P,a1 as ee,V as ae,a2 as T,a3 as te,a4 as le,G as oe,a6 as se,a7 as ne,s as re,a8 as ie,a9 as ue,ab as ce,ac as de,ad as pe}from"./index-DTjOUT29.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as me}from"./upload-CdCxZR_z.js";const fe=(p=1)=>B.get("/admin/articles"),ge=p=>B.get(`/admin/article/${p}`),_e=p=>B.post("/admin/article",p),ve=(p,b)=>B.put(`/admin/article/${p}`,b),ye=p=>B.delete(`/admin/article/${p}`),be={class:"dialog-footer"},Ve={__name:"DialogAdminArticle",emits:"article-update",setup(p,{expose:b,emit:I}){const V=i(!1),m=i(""),E=i(!1),k=i(!1),f=i(),C=i(!1),h=I,q=i(),t=W({id:"",author:"",title:"",description:"",content:"",image:"",tag:[],create_at:"",isPublic:!1}),n=r=>{V.value=!0,E.value=!0,Object.assign(t,{id:"",author:"",title:"",description:"",content:"",image:"",tag:[],create_at:"",isPublic:!1}),r?(C.value=!0,Object.assign(t,r),t.create_at=Number(r.create_at)*1e3):C.value=!1,E.value=!1},u=r=>{t.tag.splice(t.tag.indexOf(r),1)},U=()=>{k.value=!0,ae(()=>{f.value&&f.value.input&&f.value.input.focus()})},c=()=>{m.value&&t.tag.push(m.value),k.value=!1,m.value=""},$=(r,e)=>{console.log(r,e)},N=async({file:r,onError:e,onSuccess:A})=>{try{const w=await me(r);t.image=w.imageUrl,A()}catch(w){T.error({type:"error",message:"圖片上傳失敗"}),e(w)}},L=async()=>{E.value=!0;const r={...t,create_at:Number(t.create_at)/1e3};try{const e=C.value?await ve(r.id,{data:r}):await _e({data:r});e.success?(T({type:"success",message:e.message}),h("article-update")):T({type:"error",message:e.message})}catch(e){console.error(e)}finally{V.value=!1}};return b({open:n}),(r,e)=>{const A=Q,w=Z,O=F;return z((d(),y(l(ee),{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=s=>V.value=s),title:"Tips",width:"700","align-center":""},{header:o(()=>[P("h3",null,R(C.value?"修改文章":"新增文章"),1)]),footer:o(()=>[P("div",be,[a(l(x),{onClick:e[8]||(e[8]=s=>V.value=!1)},{default:o(()=>e[12]||(e[12]=[v("取消")])),_:1}),a(l(x),{type:"primary",onClick:L},{default:o(()=>e[13]||(e[13]=[v(" 確認 ")])),_:1})])]),default:o(()=>[a(l(G),{model:t,"label-width":"auto"},{default:o(()=>[a(l(H),{gutter:10},{default:o(()=>[a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"標題"},{default:o(()=>[a(l(D),{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=s=>t.title=s)},null,8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:16},{default:o(()=>[a(l(_),{label:"作者"},{default:o(()=>[a(l(D),{modelValue:t.author,"onUpdate:modelValue":e[1]||(e[1]=s=>t.author=s)},null,8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:8},{default:o(()=>[a(l(_),{label:"日期"},{default:o(()=>[a(l(X),{modelValue:t.create_at,"onUpdate:modelValue":e[2]||(e[2]=s=>t.create_at=s),type:"date",placeholder:"Pick a Date",format:"YYYY/MM/DD","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"標籤"},{default:o(()=>[(d(!0),M(j,null,S(t.tag,s=>(d(),y(l(Y),{key:s,closable:"","disable-transitions":!1,onClose:Ce=>u(s),style:{"margin-right":"5px"}},{default:o(()=>[v(R(s),1)]),_:2},1032,["onClose"]))),128)),k.value?(d(),y(l(D),{key:0,ref_key:"InputRef",ref:f,modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=s=>m.value=s),class:"tag-input",style:{width:"60px"},size:"small",onKeyup:J(c,["enter"]),onBlur:c},null,8,["modelValue"])):(d(),y(l(x),{key:1,class:"button-new-tag",size:"small",onClick:U},{default:o(()=>e[10]||(e[10]=[v(" + New Tag ")])),_:1}))]),_:1})]),_:1}),a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"描述"},{default:o(()=>[a(l(D),{modelValue:t.description,"onUpdate:modelValue":e[4]||(e[4]=s=>t.description=s),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"內容"},{default:o(()=>[a(l(D),{modelValue:t.content,"onUpdate:modelValue":e[5]||(e[5]=s=>t.content=s),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"圖片"},{default:o(()=>[a(A,{modelValue:t.image,"onUpdate:modelValue":e[6]||(e[6]=s=>t.image=s),class:"upload-demo","on-remove":$,"http-request":N,"list-type":"picture",limit:1,ref_key:"upload",ref:q},{default:o(()=>[a(l(x),{type:"plain"},{default:o(()=>e[11]||(e[11]=[v("選擇照片")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(l(g),{span:24},{default:o(()=>[a(l(_),{label:"是否公開"},{default:o(()=>[a(w,{modelValue:t.isPublic,"onUpdate:modelValue":e[7]||(e[7]=s=>t.isPublic=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])),[[O,E.value]])}}},Ee=K(Ve,[["__scopeId","data-v-142f9b88"]]),ke={class:"top-area"},Ae={class:"content-area"},we={class:"bottom-area"},xe={__name:"Articles",setup(p){const b=i(!1),I=i(),V=i(),m=i(1),E=i(1),k=te("dialogAdminArticleRef"),f=async()=>{b.value=!0;try{const t=await fe();t.success&&(I.value=t.articles,V.value=t.pagination,m.value=t.pagination.current_page,E.value=t.pagination.total_pages)}catch(t){console.error(t)}finally{b.value=!1}},C=async()=>{k.value.open()},h=async t=>{try{const n=await ge(t.id);n.success?k.value.open(n.article):T({type:"error",message:n.message})}catch(n){console.error(n)}},q=async t=>{await pe.confirm(`請確認是否刪除文章：${t.title}`,"Warning",{confirmButtonText:"確認",cancelButtonText:"取消",type:"warning",beforeClose:async(n,u,U)=>{if(n==="confirm"){u.confirmButtonLoading=!0;try{const c=await ye(t.id);c.success?(T({type:"success",message:c.message}),U(),await f()):(T({type:"error",message:c.message}),u.confirmButtonLoading=!1)}catch(c){console.error(c)}}else U()}})};return le(()=>{f()}),(t,n)=>{const u=ne,U=Y,c=oe("font-awesome-icon"),$=re,N=se,L=ce,r=F;return d(),M(j,null,[a(l(de),{class:"card"},{default:o(()=>[P("div",ke,[n[2]||(n[2]=P("h3",null,"文章列表",-1)),a(l(x),{type:"primary",onClick:C},{default:o(()=>n[1]||(n[1]=[v(" 新增文章 ")])),_:1})]),P("div",Ae,[z((d(),y(N,{stripe:!0,style:{height:"100%"},data:I.value,"table-layout":"auto"},{default:o(()=>[a(u,{label:"建立日期",prop:"create_at"},{default:o(({row:e})=>[v(R(new Date(e.create_at*1e3).toLocaleDateString().slice(0,10)),1)]),_:1}),a(u,{label:"作者",prop:"author"}),a(u,{label:"文章名稱",prop:"title"}),a(u,{label:"標籤",prop:"tag"},{default:o(({row:e})=>[(d(!0),M(j,null,S(e.tag,(A,w)=>(d(),y(U,{key:w,effect:"plain",class:"tag"},{default:o(()=>[v(R(A),1)]),_:2},1024))),128))]),_:1}),a(u,{label:"是否公開",prop:"isPublic",align:"center"},{default:o(({row:e})=>[e.isPublic?(d(),y($,{key:0,class:"check-icon"},{default:o(()=>[a(c,{icon:["fas","check"]})]),_:1})):(d(),y($,{key:1,class:"x-icon"},{default:o(()=>[a(c,{icon:["fas","xmark"]})]),_:1}))]),_:1}),a(u,{width:"1"},{default:o(({row:e})=>[a(l(x),{icon:l(ie),size:"small",onClick:A=>h(e)},null,8,["icon","onClick"]),a(l(x),{icon:l(ue),type:"danger",size:"small",onClick:A=>q(e)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[r,b.value]])]),P("div",we,[a(L,{class:"pagination","current-page":m.value,"onUpdate:currentPage":n[0]||(n[0]=e=>m.value=e),layout:"prev, pager, next, jumper","page-count":E.value},null,8,["current-page","page-count"])])]),_:1}),a(l(Ee),{ref_key:"dialogAdminArticleRef",ref:k,onArticleUpdate:f},null,512)],64)}}},Be=K(xe,[["__scopeId","data-v-ad5cbdc3"]]);export{Be as default};
