import{a as B}from"./api-D0beKIRp.js";import{r as _,a as h,p as k,o as w,w as o,b as a,h as t,E as P,W as R,X as D,f as y,g as U,ag as j,a0 as q,e as b,j as E,k as x,K as I,a1 as F,a2 as T,a3 as L,a4 as S,c as Y,F as z,ac as O,G as W,a5 as G,a6 as K,a7 as v,s as X,a8 as H,a9 as J,aa as Q,ab as Z,ad as ee}from"./index-DTjOUT29.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae=(r=1)=>B.get(`admin/coupons?page=${r}`),te=r=>B.post("/admin/coupon",r),le=(r,m)=>B.put(`/admin/coupon/${r}`,m),oe=r=>B.delete(`/admin/coupon/${r}`),ne={class:"dialog-footer"},se={__name:"DialogAdminCoupon",emits:["coupon-added"],setup(r,{expose:m,emit:V}){const c=_(!1),g=_(!1),f=_(!1),C=V,n=h({id:"",title:"",is_enabled:!0,percent:0,due_date:Date.now(),code:""}),$=[{text:"今日",value:new Date},{text:"明日",value:()=>{const e=new Date;return e.setTime(e.getTime()+3600*1e3*24),e}},{text:"下週",value:()=>{const e=new Date;return e.setTime(e.getTime()+3600*1e3*24*7),e}},{text:"下個月",value:()=>{const e=new Date;return e.setTime(e.getTime()+3600*1e3*24*7*4),e}}],A=e=>{f.value=!1,Object.assign(n,{title:"",is_enabled:!0,percent:0,due_date:Date.now(),code:""}),e&&(Object.assign(n,e),n.is_enabled=e.is_enabled===1,n.due_date=e.due_date*1e3,f.value=!0),c.value=!0},u=async e=>{g.value=!0;let l={title:e.title,is_enabled:e.is_enabled?0:1,percent:Number(e.percent),due_date:Math.floor(e.due_date/1e3),code:e.code};try{const s=f.value?await le(e.id,{data:l}):await te({data:l});s.success?(T({type:"success",message:s.message}),c.value=!1,C("coupon-added")):T({type:"error",message:s.message})}catch(s){console.error(s)}finally{g.value=!1}},i=e=>e.getTime()<Date.now();return m({open:A}),(e,l)=>{const s=q;return w(),k(t(F),{modelValue:c.value,"onUpdate:modelValue":l[7]||(l[7]=d=>c.value=d),width:"800"},{header:o(()=>[b("h3",null,I(f.value?"修改折價券":"新增折價券"),1)]),footer:o(()=>[b("div",ne,[a(t(E),{onClick:l[5]||(l[5]=d=>c.value=!1)},{default:o(()=>l[8]||(l[8]=[x("取消")])),_:1}),a(t(E),{type:"primary",onClick:l[6]||(l[6]=d=>u(n))},{default:o(()=>l[9]||(l[9]=[x(" 確認 ")])),_:1})])]),default:o(()=>[a(t(P),{"label-width":"auto",model:n},{default:o(()=>[a(t(R),{gutter:20},{default:o(()=>[a(t(D),{span:24},{default:o(()=>[a(t(y),{label:"標題","label-position":"left"},{default:o(()=>[a(t(U),{placeholder:"請輸入優惠券標題",modelValue:n.title,"onUpdate:modelValue":l[0]||(l[0]=d=>n.title=d)},null,8,["modelValue"])]),_:1})]),_:1}),a(t(D),{span:12},{default:o(()=>[a(t(y),{label:"折扣(%)","label-position":"left"},{default:o(()=>[a(t(U),{placeholder:"請輸入優惠券折扣(%)",type:"number",modelValue:n.percent,"onUpdate:modelValue":l[1]||(l[1]=d=>n.percent=d)},null,8,["modelValue"])]),_:1})]),_:1}),a(t(D),{span:12},{default:o(()=>[a(t(y),{label:"優惠碼","label-position":"left"},{default:o(()=>[a(t(U),{placeholder:"請輸入優惠碼",modelValue:n.code,"onUpdate:modelValue":l[2]||(l[2]=d=>n.code=d)},null,8,["modelValue"])]),_:1})]),_:1}),a(t(D),{span:12},{default:o(()=>[a(t(y),{label:"到期日","label-position":"left"},{default:o(()=>[a(t(j),{type:"date",placeholder:"請選擇到期日期","disabled-date":i,shortcuts:$,modelValue:n.due_date,"onUpdate:modelValue":l[3]||(l[3]=d=>n.due_date=d),format:"YYYY/MM/DD","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),a(t(y),{label:"是否啟用"},{default:o(()=>[a(s,{modelValue:n.is_enabled,"onUpdate:modelValue":l[4]||(l[4]=d=>n.is_enabled=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},de=M(se,[["__scopeId","data-v-c23f11ec"]]),ue={class:"top-area"},ie={class:"content-area"},re={class:"bottom-area"},ce={__name:"Coupons",setup(r){const m=_(!1),V=_(),c=_(1),g=L("dialogAdminCouponRef"),f=_(1),C=async()=>{m.value=!0;try{const u=await ae();u.success&&(V.value=u.coupons,f.value=u.pagination.total_pages,c.value=u.pagination.current_page)}catch(u){console.error(u)}finally{m.value=!1}},n=()=>{g.value.open()},$=u=>{g.value.open(u)},A=async u=>{await ee.confirm(`請確認是否刪除折價券：${u.title}`,"Warning",{confirmButtonText:"確認",cancelButtonText:"取消",type:"warning",beforeClose:async(i,e,l)=>{if(i==="confirm"){e.confirmButtonLoading=!0;try{const s=await oe(u.id);s.success?(T({type:"success",message:s.message}),l(),await C()):(T({type:"error",message:s.message}),e.confirmButtonLoading=!1)}catch(s){console.error(s)}}else l()}})};return S(()=>{C()}),(u,i)=>{const e=W("font-awesome-icon"),l=X,s=O,d=Q;return w(),Y(z,null,[a(s,{class:"card"},{default:o(()=>[b("div",ue,[i[2]||(i[2]=b("h3",null,"優惠券列表",-1)),a(t(E),{type:"primary",onClick:n},{default:o(()=>i[1]||(i[1]=[x(" 新增優惠券 ")])),_:1})]),b("div",ie,[G((w(),k(t(K),{stripe:!0,style:{height:"100%"},data:V.value,"table-layout":"auto"},{default:o(()=>[a(t(v),{label:"名稱",prop:"title"}),a(t(v),{label:"折扣碼",prop:"code"}),a(t(v),{label:"折扣(%)",prop:"percent",align:"center"}),a(t(v),{label:"到期日",prop:"due_date"},{default:o(({row:p})=>[x(I(new Date(p.due_date*1e3).toLocaleDateString().slice(0,10)),1)]),_:1}),a(t(v),{label:"啟用狀態",prop:"is_enabled",align:"center"},{default:o(({row:p})=>[p.is_enabled?(w(),k(l,{key:0,class:"check-icon"},{default:o(()=>[a(e,{icon:["fas","check"]})]),_:1})):(w(),k(l,{key:1,class:"x-icon"},{default:o(()=>[a(e,{icon:["fas","xmark"]})]),_:1}))]),_:1}),a(t(v),{width:"1"},{default:o(({row:p})=>[a(t(E),{icon:t(H),size:"small",onClick:N=>$(p)},null,8,["icon","onClick"]),a(t(E),{icon:t(J),type:"danger",size:"small",onClick:N=>A(p)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[d,m.value]])]),b("div",re,[a(t(Z),{class:"pagination","current-page":c.value,"onUpdate:currentPage":i[0]||(i[0]=p=>c.value=p),layout:"prev, pager, next, jumper","page-count":f.value},null,8,["current-page","page-count"])])]),_:1}),a(t(de),{ref_key:"dialogAdminCouponRef",ref:g,onCouponAdded:C},null,512)],64)}}},_e=M(ce,[["__scopeId","data-v-f489085f"]]);export{_e as default};
