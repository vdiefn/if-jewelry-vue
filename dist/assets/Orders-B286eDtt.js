import{a as Y}from"./api-D0beKIRp.js";import{r as b,a as F,ae as H,a5 as A,aa as P,p as k,o as g,w as l,b as e,h as o,E as S,W as N,af as $,k as i,X as f,f as u,ag as I,a0 as z,g as W,a6 as L,a7 as R,K as v,c as M,e as V,j as O,a1 as G,a2 as D,a3 as K,M as X,a4 as J,F as Q,G as Z,s as h,a8 as ee,a9 as ae,ab as te,ac as le,ad as oe}from"./index-DTjOUT29.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se=(p=1)=>Y.get(`/admin/orders?page=${p}`),ne=p=>Y.put(`/admin/order/${p.id}`,{data:p}),de=p=>Y.delete(`/admin/order/${p}`),re={key:0},ue={key:1},ie={class:"dialog-footer"},pe={__name:"DialogAdminOrder",emits:["order-update"],setup(p,{expose:y,emit:w}){const r=b(!1),E=b(!1),x=w,s=F({create_at:"",is_paid:!1,paid_date:"",message:"",products:{},total:0,user:{name:"",email:"",tel:"",address:""}}),C=H(()=>Object.values(s.products)),U=n=>{Object.assign(s,{...n,create_at:n.create_at*1e3,paid_date:n.paid_date*1e3}),r.value=!0},m=async()=>{E.value=!0;const n={...s,create_at:s.create_at/1e3,paid_date:s.paid_date/1e3};try{const a=await ne(n);a.success?(D({type:"success",message:a.message}),x("order-update")):D({type:"error",message:a.message})}catch(a){console.error(a)}finally{r.value=!1}};return y({open:U}),(n,a)=>{const _=z,d=W,c=R,B=L,T=P;return A((g(),k(o(G),{modelValue:r.value,"onUpdate:modelValue":a[10]||(a[10]=t=>r.value=t),width:"1000px","align-center":""},{header:l(()=>a[11]||(a[11]=[V("h3",null,"修改訂單",-1)])),footer:l(()=>[V("div",ie,[e(o(O),{onClick:a[9]||(a[9]=t=>r.value=!1)},{default:l(()=>a[15]||(a[15]=[i("關閉")])),_:1}),e(o(O),{type:"primary",onClick:m},{default:l(()=>a[16]||(a[16]=[i(" 確認 ")])),_:1})])]),default:l(()=>[e(o(S),{model:s,"label-width":"auto"},{default:l(()=>[e(o(N),null,{default:l(()=>[e(o($),{"content-position":"left"},{default:l(()=>a[12]||(a[12]=[i("訂單資訊")])),_:1}),e(o(f),{span:12},{default:l(()=>[e(o(u),{label:"建立時間"},{default:l(()=>[e(o(I),{modelValue:s.create_at,"onUpdate:modelValue":a[0]||(a[0]=t=>s.create_at=t),type:"datetime",placeholder:"選擇建立時間",format:"YYYY-MM-DD HH:mm:ss","value-format":"x",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o(f),{span:12},{default:l(()=>[e(o(u),{label:"付款時間"},{default:l(()=>[e(o(I),{modelValue:s.paid_date,"onUpdate:modelValue":a[1]||(a[1]=t=>s.paid_date=t),type:"datetime",placeholder:"選擇付款時間",format:"YYYY-MM-DD HH:mm:ss","value-format":"x",disabled:s.is_paid},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(o(f),{span:24},{default:l(()=>[e(o(u),{label:"是否付款"},{default:l(()=>[e(_,{modelValue:s.is_paid,"onUpdate:modelValue":a[2]||(a[2]=t=>s.is_paid=t),"active-text":"已付款","inactive-text":"未付款"},null,8,["modelValue"])]),_:1})]),_:1}),e(o(f),{span:24},{default:l(()=>[e(o(u),{label:"留言"},{default:l(()=>[e(d,{modelValue:s.message,"onUpdate:modelValue":a[3]||(a[3]=t=>s.message=t),type:"textarea",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o($),{"content-position":"left"},{default:l(()=>a[13]||(a[13]=[i("用戶資料")])),_:1}),e(o(f),{span:12},{default:l(()=>[e(o(u),{label:"姓名"},{default:l(()=>[e(d,{modelValue:s.user.name,"onUpdate:modelValue":a[4]||(a[4]=t=>s.user.name=t),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(o(f),{span:12},{default:l(()=>[e(o(u),{label:"電話"},{default:l(()=>[e(d,{modelValue:s.user.tel,"onUpdate:modelValue":a[5]||(a[5]=t=>s.user.tel=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(o(f),{span:24},{default:l(()=>[e(o(u),{label:"Email"},{default:l(()=>[e(d,{modelValue:s.user.email,"onUpdate:modelValue":a[6]||(a[6]=t=>s.user.email=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(o(f),{span:24},{default:l(()=>[e(o(u),{label:"地址"},{default:l(()=>[e(d,{modelValue:s.user.address,"onUpdate:modelValue":a[7]||(a[7]=t=>s.user.address=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(o($),{"content-position":"left"},{default:l(()=>a[14]||(a[14]=[i("商品明細")])),_:1}),e(B,{data:C.value,border:"","table-layout":"auto"},{default:l(()=>[e(c,{label:"商品名稱"},{default:l(t=>[i(v(t.row.product.title),1)]),_:1}),e(c,{label:"單價",prop:"product.price",align:"center",width:"1"}),e(c,{label:"數量",prop:"qty",width:"1",align:"center"}),e(c,{label:"小計",width:"1",align:"center"},{default:l(t=>[i(v(t.row.total),1)]),_:1}),e(c,{label:"折扣後",width:"1",align:"center"},{default:l(t=>[i(v(t.row.final_total),1)]),_:1}),e(c,{label:"優惠券",width:"1",align:"center"},{default:l(t=>[t.row.coupon?(g(),M("span",re,v(t.row.coupon.code)+" ("+v(t.row.coupon.percent)+"%)",1)):(g(),M("span",ue,"無"))]),_:1})]),_:1},8,["data"]),e(o(u),{label:"總金額",style:{"margin-top":"16px"}},{default:l(()=>[e(d,{modelValue:s.total,"onUpdate:modelValue":a[8]||(a[8]=t=>s.total=t),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])),[[T,E.value]])}}},me=j(pe,[["__scopeId","data-v-2e4458b2"]]),ce={class:"content-area"},fe={class:"bottom-area"},_e={__name:"Orders",setup(p){const y=b(!1),w=b(),r=b(1),E=b(1),x=K("dialogAdminOrderRef"),s=async(m=1)=>{r.value=m,y.value=!0;try{const n=await se(r.value);n.success&&(w.value=n.orders,r.value=n.pagination.current_page,E.value=n.pagination.total_pages)}catch(n){console.error(n)}finally{y.value=!1}},C=m=>{x.value.open(m)},U=async m=>{await oe.confirm("請確認是否刪除訂單","Warning",{confirmButtonText:"確認",cancelButtonText:"取消",type:"warning",beforeClose:async(n,a,_)=>{if(n==="confirm"){a.confirmButtonLoading=!0;try{const d=await de(m.id);d.success?(D({type:"success",message:d.message}),_(),await s(r.value)):(D({type:"error",message:d.message}),a.confirmButtonLoading=!1)}catch(d){console.error(d)}}else _()}})};return X(r,()=>{s(r.value)}),J(()=>{s()}),(m,n)=>{const a=R,_=Z("font-awesome-icon"),d=h,c=L,B=te,T=P;return g(),M(Q,null,[e(o(le),{class:"card"},{default:l(()=>[n[2]||(n[2]=V("div",{class:"top-area"},[V("h3",null,"訂單列表")],-1)),V("div",ce,[A((g(),k(c,{stripe:!0,style:{height:"100%"},data:w.value,"table-layout":"auto"},{default:l(()=>[e(a,{label:"建立日期",prop:"create_at"},{default:l(({row:t})=>[i(v(new Date(t.create_at*1e3).toLocaleDateString().slice(0,10)),1)]),_:1}),e(a,{label:"購買人",prop:"user.name"}),e(a,{label:"購買金額",prop:"total"}),e(a,{label:"付款完成",prop:"is_paid",align:"center"},{default:l(({row:t})=>[t.is_paid?(g(),k(d,{key:0,class:"check-icon"},{default:l(()=>[e(_,{icon:["fas","check"]})]),_:1})):(g(),k(d,{key:1,class:"x-icon"},{default:l(()=>[e(_,{icon:["fas","xmark"]})]),_:1}))]),_:1}),e(a,{label:"留言訊息",prop:"message"}),e(a,{width:"1"},{default:l(({row:t})=>[e(o(O),{icon:o(ee),size:"small",onClick:q=>C(t)},null,8,["icon","onClick"]),e(o(O),{icon:o(ae),type:"danger",size:"small",onClick:q=>U(t)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[T,y.value]])]),V("div",fe,[e(B,{class:"pagination","current-page":r.value,"onUpdate:currentPage":n[0]||(n[0]=t=>r.value=t),layout:"prev, pager, next, jumper","page-count":E.value},null,8,["current-page","page-count"])])]),_:1}),e(o(me),{ref_key:"dialogAdminOrderRef",ref:x,onOrderUpdate:n[1]||(n[1]=t=>s(1))},null,512)],64)}}},Ve=j(_e,[["__scopeId","data-v-02065659"]]);export{Ve as default};
