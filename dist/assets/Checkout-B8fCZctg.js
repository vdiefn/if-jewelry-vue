import{r as N,a as F,c as E,b as l,e as u,w as r,h as m,p as c,I,ac as G,j as L,d as z,o as p,aw as M,ax as K,E as X,f as J,g as Q,x as W,ay as Z,k as f,F as H,K as v,az as ee,aA as le,H as re,a2 as h}from"./index-DTjOUT29.js";import{a as P}from"./api-D0beKIRp.js";import{u as ae}from"./cart-DDR8xpIB.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=y=>P.post("/order",y),de=y=>P.post(`/pay/${y}`),ue={class:"container"},se={class:"step-content"},ne={class:"credit-card-grid"},ie={class:"expire-date-wrapper"},pe={class:"step-actions"},me={class:"image-wrapper"},ce=["src"],fe={class:"info-wrapper"},ve={class:"final-info"},ge={__name:"Checkout",setup(y){const b=ae(),R=z(),k=N(""),n=N(0),V=N(null),C=N(null),t=F({name:"",address:"",phone:"",email:"",message:"",delivery:"home delivery",pickupStore:"",payment:"credit card"}),S=F({name:[{required:!0,message:"請提供收件人姓名",trigger:"blur"}],address:[{required:!0,message:"請提供收件地址",trigger:"blur"}],phone:[{validator:(d,e,o)=>{if(!e)return o(new Error("請提供手機號碼!"));if(!/^09\d{8}$/.test(e))return o(new Error("手機號碼格式錯誤!"));o()},trigger:"blur"}],email:[{required:!0,message:"請提供Email",trigger:"blur"},{type:"email",message:"Email 格式錯誤",trigger:"blur"}],delivery:[{required:!0,message:"請選擇寄送方式",trigger:"change"}],pickupStore:[{validator:(d,e,o)=>{t.delivery==="store pickup"&&!e?o(new Error("請填寫超商店名")):o()},trigger:"blur"}]}),i=F({cardHolderName:"",cardNumber1:"",cardNumber2:"",cardNumber3:"",cardNumber4:"",expireMonth:"",expireYear:"",cvvNumber:""}),w=(d,e,o)=>{e||o(new Error("請填寫卡號")),/^\d{4}$/.test(e)?o():o(new Error("卡號須為4個數字!"))},$={cardHolderName:[{required:!0,message:"請填寫持卡人姓名",trigger:"blur"}],cardNumber1:[{validator:w,trigger:"blur"}],cardNumber2:[{validator:w,trigger:"blur"}],cardNumber3:[{validator:w,trigger:"blur"}],cardNumber4:[{validator:w,trigger:"blur"}],expireMonth:[{required:!0,message:"請填寫月份",trigger:"blur"},{pattern:/^(0[1-9]|1[0-2])$/,message:"月份需為 01-12",trigger:"blur"}],expireYear:[{required:!0,message:"請填寫年份",trigger:"blur"},{pattern:/^\d{2}$/,message:"年份須為兩位數",trigger:"blur"}],cvvNumber:[{validator:(d,e,o)=>{e||o(new Error("請輸入卡片後三碼")),/^\d{3}$/.test(e)?o():o(new Error("後三碼須為3個數字"))},trigger:"blur"}]},U=async d=>{if(d)try{if(n.value===0&&await d.validateField(["name","address","phone","email"]),n.value===1){const e=["delivery"];t.delivery==="store pickup"&&e.push("pickupStore"),await d.validateField(e)}return n.value===2&&t.payment==="credit card"&&await C.value.validate(),!0}catch(e){return console.error("驗證失敗",e),!1}},T=async()=>{try{const d=await oe({data:{user:{name:t.name,email:t.email,tel:t.phone,address:t.address},message:t.message}});d.success?(k.value=d.orderId,h({type:"success",message:d.message})):h({type:"error",message:d.message})}catch(d){console.error(d)}},Y=async()=>{n.value===0?await U(V.value)&&(await T(),n.value++):n.value===1?await U(V.value)&&n.value++:n.value===2&&(t.payment==="atm transfer"?await A():await U(C.value)&&await A())},D=()=>{n.value>0?n.value--:R.push("/cart")},A=async()=>{try{const d=await de(k.value);d.success?(h({type:"success",message:d.message}),b.clearCart(),await R.push({path:"/success",query:{orderId:k.value}})):h({type:"error",message:d.message})}catch(d){console.error(d)}};return(d,e)=>{const o=Q,s=J,_=X,g=G,x=Z,B=W,q=L,O=le,j=ee;return p(),E("div",ue,[l(m(K),{style:{},active:n.value,"align-center":""},{default:r(()=>[l(m(M),{title:"Step 1",description:"收件資訊"}),l(m(M),{title:"Step 2",description:"配送方式"}),l(m(M),{title:"Step 3",description:"付款資訊"})]),_:1},8,["active"]),u("div",se,[n.value===0?(p(),c(g,{key:0},{default:r(()=>[e[16]||(e[16]=u("h3",null,"收件資訊",-1)),l(_,{model:t,"label-width":"auto",rules:S,ref_key:"formRef",ref:V},{default:r(()=>[l(s,{label:"收件人姓名",prop:"name"},{default:r(()=>[l(o,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),placeholder:"收件人姓名"},null,8,["modelValue"])]),_:1}),l(s,{label:"收件地址",prop:"address"},{default:r(()=>[l(o,{modelValue:t.address,"onUpdate:modelValue":e[1]||(e[1]=a=>t.address=a),placeholder:"地址"},null,8,["modelValue"])]),_:1}),l(s,{label:"連絡電話",prop:"phone"},{default:r(()=>[l(o,{modelValue:t.phone,"onUpdate:modelValue":e[2]||(e[2]=a=>t.phone=a),placeholder:"0912345678"},null,8,["modelValue"])]),_:1}),l(s,{label:"Email",prop:"email"},{default:r(()=>[l(o,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=a=>t.email=a),placeholder:"電子郵件"},null,8,["modelValue"])]),_:1}),l(s,{label:"想說的話"},{default:r(()=>[l(o,{modelValue:t.message,"onUpdate:modelValue":e[4]||(e[4]=a=>t.message=a),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1})):n.value===1?(p(),c(g,{key:1},{default:r(()=>[l(_,{model:t,"label-width":"auto",rules:S,ref_key:"formRef",ref:V},{default:r(()=>[l(s,{label:"寄送方式",prop:"delivery"},{default:r(()=>[l(B,{modelValue:t.delivery,"onUpdate:modelValue":e[5]||(e[5]=a=>t.delivery=a)},{default:r(()=>[l(x,{label:"宅配",value:"home delivery"},{default:r(()=>e[17]||(e[17]=[f("宅配")])),_:1}),l(x,{label:"超商取貨不付款",value:"store pickup"},{default:r(()=>e[18]||(e[18]=[f("全家取貨不付款")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t.delivery==="store pickup"?(p(),c(s,{key:0,label:"超商店名",prop:"pickupStore"},{default:r(()=>[l(o,{modelValue:t.pickupStore,"onUpdate:modelValue":e[6]||(e[6]=a=>t.pickupStore=a),style:{width:"200px"}},null,8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["model","rules"])]),_:1})):n.value===2?(p(),c(g,{key:2},{default:r(()=>[l(_,{"label-width":"100px",model:t,rules:S},{default:r(()=>[l(s,{label:"付款方式",prop:"payment"},{default:r(()=>[l(B,{modelValue:t.payment,"onUpdate:modelValue":e[7]||(e[7]=a=>t.payment=a)},{default:r(()=>[l(x,{label:"信用卡",value:"credit card"},{default:r(()=>e[19]||(e[19]=[f("信用卡")])),_:1}),l(x,{label:"ATM轉帳",value:"atm transfer"},{default:r(()=>e[20]||(e[20]=[f("ATM轉帳")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t.payment==="credit card"?(p(),c(_,{key:0,model:i,"label-width":"100px",class:"credit-card-info-wrapper",ref_key:"creditCardFormRef",ref:C,rules:$},{default:r(()=>[l(s,{label:"持卡人姓名",class:"card-holder-wrapper",prop:"cardHolderName"},{default:r(()=>[l(o,{modelValue:i.cardHolderName,"onUpdate:modelValue":e[8]||(e[8]=a=>i.cardHolderName=a),placeholder:"持卡人姓名"},null,8,["modelValue"])]),_:1}),l(s,{label:"信用卡卡號",class:"credit-card-grid-wrapper"},{default:r(()=>[u("div",ne,[l(s,{prop:"cardNumber1","label-width":"0"},{default:r(()=>[l(o,{modelValue:i.cardNumber1,"onUpdate:modelValue":e[9]||(e[9]=a=>i.cardNumber1=a),placeholder:"1234",maxlength:"4"},null,8,["modelValue"])]),_:1}),l(s,{prop:"cardNumber2","label-width":"0"},{default:r(()=>[l(o,{modelValue:i.cardNumber2,"onUpdate:modelValue":e[10]||(e[10]=a=>i.cardNumber2=a),placeholder:"5678",maxlength:"4"},null,8,["modelValue"])]),_:1}),l(s,{prop:"cardNumber3","label-width":"0"},{default:r(()=>[l(o,{modelValue:i.cardNumber3,"onUpdate:modelValue":e[11]||(e[11]=a=>i.cardNumber3=a),placeholder:"9012",maxlength:"4"},null,8,["modelValue"])]),_:1}),l(s,{prop:"cardNumber4","label-width":"0"},{default:r(()=>[l(o,{modelValue:i.cardNumber4,"onUpdate:modelValue":e[12]||(e[12]=a=>i.cardNumber4=a),placeholder:"3456",maxlength:"4"},null,8,["modelValue"])]),_:1})])]),_:1}),u("div",ie,[l(s,{label:"到期月份",prop:"expireMonth"},{default:r(()=>[l(o,{modelValue:i.expireMonth,"onUpdate:modelValue":e[13]||(e[13]=a=>i.expireMonth=a),placeholder:"MM",maxlength:"2"},null,8,["modelValue"])]),_:1}),l(s,{label:"到期年份",prop:"expireYear"},{default:r(()=>[l(o,{modelValue:i.expireYear,"onUpdate:modelValue":e[14]||(e[14]=a=>i.expireYear=a),placeholder:"YY",maxlength:"2"},null,8,["modelValue"])]),_:1})]),l(s,{label:"後三碼",class:"cvv-wrapper",prop:"cvvNumber"},{default:r(()=>[l(o,{modelValue:i.cvvNumber,"onUpdate:modelValue":e[15]||(e[15]=a=>i.cvvNumber=a),placeholder:"後三碼",maxlength:"3","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):t.payment==="atm transfer"?(p(),E(H,{key:1},[l(g,{class:"account-info"},{default:r(()=>e[21]||(e[21]=[u("h6",null,"帳戶資訊",-1),u("p",null,"銀行名稱: OX銀行 (ox分行)",-1),u("p",null,"銀行代碼: 999",-1),u("p",null,"銀行帳號: 1234567654321",-1)])),_:1}),l(g,null,{default:r(()=>e[22]||(e[22]=[u("h6",null,"注意事項：",-1),u("p",null,"付款完成後須主動與客服人員聯繫，確認款項無誤後才會出貨",-1),u("p",null,"Email: support@if-jewelry.com",-1),u("p",null,"電話: 02-8765-4321",-1),u("p",null,"服務時間: 週一~週五 09:00 - 18:30",-1)])),_:1})],64)):I("",!0)]),_:1},8,["model","rules"])]),_:1})):I("",!0)]),u("div",pe,[l(q,{onClick:D},{default:r(()=>[f(v(n.value>0?"上一步":"返回購物車"),1)]),_:1}),n.value===0?(p(),c(q,{key:0,type:"primary",onClick:Y},{default:r(()=>e[23]||(e[23]=[f(" 建立訂單 ")])),_:1})):(p(),c(q,{key:1,type:"primary",onClick:Y},{default:r(()=>[f(v(n.value===2?"送出訂單":"下一步"),1)]),_:1}))]),l(g,null,{default:r(()=>[l(j,null,{default:r(()=>[l(O,{class:"order-info-container"},{title:r(()=>e[24]||(e[24]=[u("h5",null,"訂單摘要",-1)])),default:r(()=>[(p(!0),E(H,null,re(m(b).cartList,a=>(p(),E("div",{key:a.id,class:"product-wrapper"},[u("div",me,[u("img",{src:a.product.imagesUrl[0],alt:"product picture"},null,8,ce)]),u("div",fe,[u("h5",null,v(a.product.title),1),u("p",null,"NTD"+v(a.product.price)+" x "+v(a.qty),1)])]))),128)),u("div",ve,[u("h6",null,"使用優惠券: "+v(m(b).couponCode?m(b).couponCode:" 無 "),1),u("h6",null,"總金額: "+v(Math.round(m(b).cartData.final_total)),1)])]),_:1})]),_:1})]),_:1})])}}},Ee=te(ge,[["__scopeId","data-v-14a405ab"]]);export{Ee as default};
